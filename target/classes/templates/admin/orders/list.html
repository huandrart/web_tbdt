<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout">
<head>
    <title>Quản lý đơn hàng - Electronic Store Admin</title>
</head>
<body>
    <div layout:decorate="~{admin/layout}">
        <div layout:fragment="content">
            <!-- Page Title -->
            <div th:with="pageTitle='Quản lý đơn hàng'"></div>
            
            <!-- Statistics Cards -->
            <div class="row g-4 mb-4">
                <div class="col-md-3">
                    <div class="stats-card">
                        <div class="d-flex align-items-center">
                            <div class="stats-icon primary me-3">
                                <i class="fas fa-shopping-cart"></i>
                            </div>
                            <div>
                                <div class="stats-number">7</div>
                                <div class="stats-label">Tổng đơn hàng</div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="stats-card">
                        <div class="d-flex align-items-center">
                            <div class="stats-icon warning me-3">
                                <i class="fas fa-clock"></i>
                            </div>
                            <div>
                                <div class="stats-number">1</div>
                                <div class="stats-label">Chờ xử lý</div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="stats-card">
                        <div class="d-flex align-items-center">
                            <div class="stats-icon info me-3">
                                <i class="fas fa-truck"></i>
                            </div>
                            <div>
                                <div class="stats-number">2</div>
                                <div class="stats-label">Đang giao</div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="stats-card">
                        <div class="d-flex align-items-center">
                            <div class="stats-icon success me-3">
                                <i class="fas fa-check-circle"></i>
                            </div>
                            <div>
                                <div class="stats-number">4</div>
                                <div class="stats-label">Đã hoàn thành</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Filters and Search -->
            <div class="card card-modern mb-4">
                <div class="card-header card-header-modern">
                    <h5 class="mb-0">
                        <i class="fas fa-filter me-2"></i>
                        Bộ lọc và tìm kiếm
                    </h5>
                </div>
                <div class="card-body">
                    <form method="get" class="row g-3">
                        <div class="col-md-3">
                            <label class="form-label fw-semibold">
                                <i class="fas fa-search me-1"></i>Tìm kiếm
                            </label>
                            <input type="text" class="form-control form-control-modern" name="search" 
                                   th:value="${search}" placeholder="Mã đơn hàng, tên khách hàng...">
                        </div>
                        <div class="col-md-2">
                            <label class="form-label fw-semibold">
                                <i class="fas fa-flag me-1"></i>Trạng thái
                            </label>
                            <select class="form-select form-select-modern" name="status">
                                <option value="">Tất cả trạng thái</option>
                                <option value="PENDING" th:selected="${status == 'PENDING'}">Chờ xử lý</option>
                                <option value="PROCESSING" th:selected="${status == 'PROCESSING'}">Đang xử lý</option>
                                <option value="SHIPPED" th:selected="${status == 'SHIPPED'}">Đang giao</option>
                                <option value="DELIVERED" th:selected="${status == 'DELIVERED'}">Đã giao</option>
                                <option value="CANCELLED" th:selected="${status == 'CANCELLED'}">Đã hủy</option>
                            </select>
                        </div>
                        <div class="col-md-2">
                            <label class="form-label fw-semibold">
                                <i class="fas fa-calendar me-1"></i>Từ ngày
                            </label>
                            <input type="date" class="form-control form-control-modern" name="fromDate" th:value="${fromDate}">
                        </div>
                        <div class="col-md-2">
                            <label class="form-label fw-semibold">
                                <i class="fas fa-calendar me-1"></i>Đến ngày
                            </label>
                            <input type="date" class="form-control form-control-modern" name="toDate" th:value="${toDate}">
                        </div>
                        <div class="col-md-2">
                            <label class="form-label fw-semibold">
                                <i class="fas fa-sort me-1"></i>Sắp xếp
                            </label>
                            <select class="form-select form-select-modern" name="sort">
                                <option value="id" th:selected="${sort == 'id'}">ID</option>
                                <option value="orderNumber" th:selected="${sort == 'orderNumber'}">Mã đơn hàng</option>
                                <option value="totalAmount" th:selected="${sort == 'totalAmount'}">Tổng tiền</option>
                                <option value="createdAt" th:selected="${sort == 'createdAt'}">Ngày tạo</option>
                            </select>
                        </div>
                        <div class="col-md-1">
                            <label class="form-label fw-semibold">&nbsp;</label>
                            <button type="submit" class="btn btn-primary-modern btn-modern w-100">
                                <i class="fas fa-search"></i>
                            </button>
                        </div>
                    </form>
                </div>
            </div>
            
            <!-- Orders Table -->
            <div class="card card-modern">
                <div class="card-header card-header-modern">
                    <h5 class="mb-0">
                        <i class="fas fa-list me-2"></i>
                        Danh sách đơn hàng
                        <span class="badge bg-primary ms-2" th:text="${totalItems}">0</span>
                    </h5>
                </div>
                <div class="card-body p-0">
                    <div class="table-responsive">
                        <table class="table table-modern mb-0">
                            <thead>
                                <tr>
                                    <th class="sortable-header" style="width: 80px;">
                                        <a href="?sort=id&direction=${reversedDirection}&search=${search}&status=${status}&fromDate=${fromDate}&toDate=${toDate}&page=${currentPage}&size=${size}" 
                                           class="text-decoration-none text-dark">
                                            ID
                                            <i th:if="${sort == 'id'}" 
                                               th:class="${direction == 'asc'} ? 'fas fa-sort-up sort-icon active' : 'fas fa-sort-down sort-icon active'"></i>
                                            <i th:unless="${sort == 'id'}" class="fas fa-sort sort-icon"></i>
                                        </a>
                                    </th>
                                    <th class="sortable-header">
                                        <a href="?sort=orderNumber&direction=${reversedDirection}&search=${search}&status=${status}&fromDate=${fromDate}&toDate=${toDate}&page=${currentPage}&size=${size}" 
                                           class="text-decoration-none text-dark">
                                            Mã đơn hàng
                                            <i th:if="${sort == 'orderNumber'}" 
                                               th:class="${direction == 'asc'} ? 'fas fa-sort-up sort-icon active' : 'fas fa-sort-down sort-icon active'"></i>
                                            <i th:unless="${sort == 'orderNumber'}" class="fas fa-sort sort-icon"></i>
                                        </a>
                                    </th>
                                    <th>Khách hàng</th>
                                    <th class="sortable-header">
                                        <a href="?sort=totalAmount&direction=${reversedDirection}&search=${search}&status=${status}&fromDate=${fromDate}&toDate=${toDate}&page=${currentPage}&size=${size}" 
                                           class="text-decoration-none text-dark">
                                            Tổng tiền
                                            <i th:if="${sort == 'totalAmount'}" 
                                               th:class="${direction == 'asc'} ? 'fas fa-sort-up sort-icon active' : 'fas fa-sort-down sort-icon active'"></i>
                                            <i th:unless="${sort == 'totalAmount'}" class="fas fa-sort sort-icon"></i>
                                        </a>
                                    </th>
                                    <th>Trạng thái</th>
                                    <th class="sortable-header">
                                        <a href="?sort=createdAt&direction=${reversedDirection}&search=${search}&status=${status}&fromDate=${fromDate}&toDate=${toDate}&page=${currentPage}&size=${size}" 
                                           class="text-decoration-none text-dark">
                                            Ngày tạo
                                            <i th:if="${sort == 'createdAt'}" 
                                               th:class="${direction == 'asc'} ? 'fas fa-sort-up sort-icon active' : 'fas fa-sort-down sort-icon active'"></i>
                                            <i th:unless="${sort == 'createdAt'}" class="fas fa-sort sort-icon"></i>
                                        </a>
                                    </th>
                                    <th style="width: 150px;">Thao tác</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>
                                        <span class="badge bg-light text-dark">#1</span>
                                    </td>
                                    <td>
                                        <span class="fw-semibold">#ORD001</span>
                                    </td>
                                    <td>
                                        <div>
                                            <div class="fw-semibold">Nguyễn Văn A</div>
                                            <small class="text-muted">nguyenvana@email.com</small>
                                        </div>
                                    </td>
                                    <td>
                                        <div class="fw-semibold text-success">₫2,500,000</div>
                                    </td>
                                    <td>
                                        <span class="badge bg-success badge-modern">Đã giao</span>
                                    </td>
                                    <td>
                                        <small>25/12/2024 14:30</small>
                                    </td>
                                    <td>
                                        <div class="action-buttons">
                                            <a href="/admin/orders/view/1" class="btn btn-outline-info btn-sm" title="Xem chi tiết">
                                                <i class="fas fa-eye"></i>
                                            </a>
                                            <a href="/admin/orders/edit/1" class="btn btn-outline-warning btn-sm" title="Chỉnh sửa">
                                                <i class="fas fa-edit"></i>
                                            </a>
                                            <button class="btn btn-outline-primary btn-sm" title="In hóa đơn">
                                                <i class="fas fa-print"></i>
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <span class="badge bg-light text-dark">#2</span>
                                    </td>
                                    <td>
                                        <span class="fw-semibold">#ORD002</span>
                                    </td>
                                    <td>
                                        <div>
                                            <div class="fw-semibold">Trần Thị B</div>
                                            <small class="text-muted">tranthib@email.com</small>
                                        </div>
                                    </td>
                                    <td>
                                        <div class="fw-semibold text-success">₫1,800,000</div>
                                    </td>
                                    <td>
                                        <span class="badge bg-warning badge-modern">Đang xử lý</span>
                                    </td>
                                    <td>
                                        <small>24/12/2024 10:15</small>
                                    </td>
                                    <td>
                                        <div class="action-buttons">
                                            <a href="/admin/orders/view/2" class="btn btn-outline-info btn-sm" title="Xem chi tiết">
                                                <i class="fas fa-eye"></i>
                                            </a>
                                            <a href="/admin/orders/edit/2" class="btn btn-outline-warning btn-sm" title="Chỉnh sửa">
                                                <i class="fas fa-edit"></i>
                                            </a>
                                            <button class="btn btn-outline-primary btn-sm" title="In hóa đơn">
                                                <i class="fas fa-print"></i>
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <span class="badge bg-light text-dark">#3</span>
                                    </td>
                                    <td>
                                        <span class="fw-semibold">#ORD003</span>
                                    </td>
                                    <td>
                                        <div>
                                            <div class="fw-semibold">Lê Văn C</div>
                                            <small class="text-muted">levanc@email.com</small>
                                        </div>
                                    </td>
                                    <td>
                                        <div class="fw-semibold text-success">₫3,200,000</div>
                                    </td>
                                    <td>
                                        <span class="badge bg-info badge-modern">Đang giao</span>
                                    </td>
                                    <td>
                                        <small>23/12/2024 16:45</small>
                                    </td>
                                    <td>
                                        <div class="action-buttons">
                                            <a href="/admin/orders/view/3" class="btn btn-outline-info btn-sm" title="Xem chi tiết">
                                                <i class="fas fa-eye"></i>
                                            </a>
                                            <a href="/admin/orders/edit/3" class="btn btn-outline-warning btn-sm" title="Chỉnh sửa">
                                                <i class="fas fa-edit"></i>
                                            </a>
                                            <button class="btn btn-outline-primary btn-sm" title="In hóa đơn">
                                                <i class="fas fa-print"></i>
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <!-- Empty State -->
                <div th:if="${orders.content.isEmpty()}" class="empty-state">
                    <i class="fas fa-shopping-cart"></i>
                    <h4>Không có đơn hàng nào</h4>
                    <p>Chưa có đơn hàng nào trong hệ thống</p>
                </div>
                
                <!-- Pagination -->
                <div class="card-footer" th:if="${orders.totalPages > 1}">
                    <nav>
                        <ul class="pagination pagination-modern justify-content-center mb-0">
                            <li class="page-item" th:classappend="${currentPage == 0} ? 'disabled'">
                                <a class="page-link" 
                                   th:href="@{/admin/orders(page=${currentPage - 1}, search=${search}, status=${status}, fromDate=${fromDate}, toDate=${toDate}, sort=${sort}, direction=${direction}, size=${size})}">
                                    <i class="fas fa-chevron-left"></i>
                                </a>
                            </li>
                            
                            <li class="page-item" th:each="pageNum : ${#numbers.sequence(0, orders.totalPages - 1)}"
                                th:classappend="${pageNum == currentPage} ? 'active'">
                                <a class="page-link" 
                                   th:href="@{/admin/orders(page=${pageNum}, search=${search}, status=${status}, fromDate=${fromDate}, toDate=${toDate}, sort=${sort}, direction=${direction}, size=${size})}"
                                   th:text="${pageNum + 1}">1</a>
                            </li>
                            
                            <li class="page-item" th:classappend="${currentPage == orders.totalPages - 1} ? 'disabled'">
                                <a class="page-link" 
                                   th:href="@{/admin/orders(page=${currentPage + 1}, search=${search}, status=${status}, fromDate=${fromDate}, toDate=${toDate}, sort=${sort}, direction=${direction}, size=${size})}">
                                    <i class="fas fa-chevron-right"></i>
                                </a>
                            </li>
                        </ul>
                    </nav>
                </div>
            </div>
        </div>
    </div>
</body>
</html>